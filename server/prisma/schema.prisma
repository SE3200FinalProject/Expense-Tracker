
// This is Prisma setup file that connects to our PostgreSQL database

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// user info for login and display
model User {
  id    String   @id @default(uuid())     
  name    String?                          
  email   String   @unique                 
  password_hash String                            
  created_at      DateTime @default(now())          
  updated_at     DateTime @updatedAt        

  // relations

  categories    Category[]                        
  expenses      Expense[]   
  budgets    Budget[]                       
}

// category table that belongs to one user
model Category {
  id    String   @id @default(uuid())         
  user_id  String                                 
  name   String  

  // timestamps
                  
  created_at DateTime @default(now())              
  updated_at DateTime @updatedAt    


  user  User  @relation(fields: [user_id], references: [id])
  expenses Expense[]                              // one category can have many expenses

  @@unique([user_id, name])                       // user cant have same category name twice
}

// expense table (belongs to one user, and maybe to a category)
model Expense {
  id  String   @id @default(uuid())        
  user_id   String                                 
  category_id  String?                                
  title         String                             
  amount Decimal  @db.Decimal(12, 2)         
  date   DateTime                            
  created_at      DateTime @default(now())            
  updated_at  DateTime @updatedAt                 

  user User  @relation(fields: [user_id], references: [id])
  category Category? @relation(fields: [category_id], references: [id])

  @@index([user_id, date])                           // for faster filtering
 
}

model Budget {
  id         String   @id @default(uuid())
  user_id    String
  month      Int
  year       Int
  amount     Decimal  @db.Decimal(12, 2)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user User @relation(fields: [user_id], references: [id])

  @@unique([user_id, month, year], name: "user_id_month_year")
}


